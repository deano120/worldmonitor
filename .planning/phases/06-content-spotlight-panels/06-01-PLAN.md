---
phase: 06-content-spotlight-panels
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/config/feeds.ts
  - src/components/BreakthroughsTickerPanel.ts
  - src/components/HeroSpotlightPanel.ts
autonomous: true
requirements:
  - SCI-01
  - SCI-02
  - HERO-01
  - HERO-02
  - HERO-03

must_haves:
  truths:
    - "BreakthroughsTickerPanel class exists, extends Panel, and renders a horizontally scrolling ticker of science items"
    - "HeroSpotlightPanel class exists, extends Panel, and renders a daily hero card with photo, excerpt, and optional map location button"
    - "HAPPY_FEEDS.science array contains 5 feeds (GNN Science + 4 new: ScienceDaily, Nature News, Live Science, New Scientist)"
    - "Hero panel gracefully handles missing lat/lon by hiding the map button"
  artifacts:
    - path: "src/components/BreakthroughsTickerPanel.ts"
      provides: "Horizontal scrolling ticker panel for science breakthroughs"
      contains: "extends Panel"
    - path: "src/components/HeroSpotlightPanel.ts"
      provides: "Daily hero spotlight card with photo, excerpt, and map location"
      contains: "extends Panel"
    - path: "src/config/feeds.ts"
      provides: "4 new science RSS feeds in HAPPY_FEEDS.science"
      contains: "ScienceDaily"
  key_links:
    - from: "src/components/BreakthroughsTickerPanel.ts"
      to: "src/components/Panel.ts"
      via: "class extends Panel"
      pattern: "extends Panel"
    - from: "src/components/HeroSpotlightPanel.ts"
      to: "src/components/Panel.ts"
      via: "class extends Panel"
      pattern: "extends Panel"
---

<objective>
Create the BreakthroughsTickerPanel and HeroSpotlightPanel panel classes, and add 4 new science RSS feeds to HAPPY_FEEDS.

Purpose: These two panels are the core content spotlight components. The ticker provides a continuously scrolling display of science breakthroughs, and the hero card highlights one extraordinary person daily. Both are data-display panels that receive items via `setItems()` / `setHeroStory()` methods (wired by App.ts in plan 06-03).

Output: Two new Panel subclasses + expanded science feed configuration.
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-content-spotlight-panels/06-RESEARCH.md
@src/components/Panel.ts
@src/components/CountersPanel.ts
@src/components/PositiveNewsFeedPanel.ts
@src/config/feeds.ts
@src/types/index.ts
@src/utils/sanitize.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add science RSS feeds and create BreakthroughsTickerPanel</name>
  <files>src/config/feeds.ts, src/components/BreakthroughsTickerPanel.ts</files>
  <action>
**1. Add 4 science RSS feeds to HAPPY_FEEDS.science in `src/config/feeds.ts`:**

In the `HAPPY_FEEDS` object, expand the `science` array from 1 feed to 5:
```typescript
science: [
  { name: 'GNN Science', url: rss('https://www.goodnewsnetwork.org/category/news/science/feed/') },
  { name: 'ScienceDaily', url: rss('https://www.sciencedaily.com/rss/top.xml') },
  { name: 'Nature News', url: rss('https://feeds.nature.com/nature/rss/current') },
  { name: 'Live Science', url: rss('https://www.livescience.com/feeds/all') },
  { name: 'New Scientist', url: rss('https://www.newscientist.com/feed/home/') },
],
```
Use the `rss()` helper (already imported) for all URLs. Do NOT use `railwayRss()` unless `rss()` fails at runtime.

**2. Create `src/components/BreakthroughsTickerPanel.ts`:**

This panel extends `Panel` from `./Panel` with `{ id: 'breakthroughs', title: 'Breakthroughs', trackActivity: false }`.

**Structure:**
- `private tickerTrack: HTMLElement | null = null;`
- Constructor calls `super(...)` then `this.createTickerDOM()`.
- `createTickerDOM()`: Creates a wrapper div (`breakthroughs-ticker-wrapper`) containing a track div (`breakthroughs-ticker-track`). Appends wrapper to `this.content` (inherited from Panel). Sets `this.content.innerHTML = ''` first, then appends.
- `public setItems(items: NewsItem[]): void` — Receives an array of `NewsItem` (imported from `@/types`). If empty, show a placeholder message. Otherwise, populate the ticker track with **doubled content** for seamless infinite scroll. Each item renders as:
  ```html
  <a class="ticker-item" href="{sanitizeUrl(item.link)}" target="_blank" rel="noopener">
    <span class="ticker-item-source">{escapeHtml(item.source)}</span>
    <span class="ticker-item-title">{escapeHtml(item.title)}</span>
  </a>
  ```
  Use `escapeHtml` and `sanitizeUrl` from `@/utils/sanitize`. Set `this.tickerTrack.innerHTML = html`.
- `public destroy(): void` — If `this.tickerTrack`, set `this.tickerTrack.style.animationPlayState = 'paused'`, then `this.tickerTrack = null`. Call `super.destroy()`.

**Important:** The CSS animation is handled entirely in CSS (plan 06-03 adds it to happy-theme.css). The JS just builds the DOM. The `animations-paused` body class already handles tab-hidden pause globally. The ticker pauses on hover via CSS `:hover` rule (no JS needed).

Import `NewsItem` from `@/types`. Import `escapeHtml`, `sanitizeUrl` from `@/utils/sanitize`.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no type errors in the new/modified files.</verify>
  <done>HAPPY_FEEDS.science has 5 feeds. BreakthroughsTickerPanel class exists, extends Panel, has setItems() accepting NewsItem[], and builds doubled ticker DOM with sanitized content.</done>
</task>

<task type="auto">
  <name>Task 2: Create HeroSpotlightPanel</name>
  <files>src/components/HeroSpotlightPanel.ts</files>
  <action>
Create `src/components/HeroSpotlightPanel.ts` extending `Panel` with `{ id: 'spotlight', title: "Today's Hero", trackActivity: false }`.

**Structure:**

- `public onLocationRequest?: (lat: number, lon: number) => void;` — Callback for map integration (set by App.ts in plan 06-03).
- Constructor calls `super(...)` then sets a default empty state message in `this.content.innerHTML` (e.g., "Loading today's hero...").
- `public setHeroStory(item: NewsItem | undefined): void` — If `item` is undefined/null, show fallback text ("No hero story available today"). Otherwise render a hero card:

  ```html
  <div class="hero-card">
    {imageHtml}
    <div class="hero-card-body">
      <span class="hero-card-source">{escapeHtml(item.source)}</span>
      <h3 class="hero-card-title">
        <a href="{sanitizeUrl(item.link)}" target="_blank" rel="noopener">{escapeHtml(item.title)}</a>
      </h3>
      <span class="hero-card-time">{formatted time}</span>
      {locationHtml}
    </div>
  </div>
  ```

  **Image handling:** If `item.imageUrl` is defined, render `<div class="hero-card-image"><img src="{sanitizeUrl(item.imageUrl)}" alt="" loading="lazy" onerror="this.parentElement.style.display='none'"></div>`. Otherwise omit.

  **Location handling (CRITICAL):** Only render a "Show on map" button if BOTH `item.lat !== undefined` AND `item.lon !== undefined`. The button has class `hero-card-location-btn` and `data-lat` / `data-lon` attributes. Wire a click handler that calls `this.onLocationRequest?.(lat, lon)`. If lat/lon are missing, do NOT render the button at all — no broken map interactions.

  **Time formatting:** Use `item.pubDate.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })` for the date display.

- `public destroy(): void` — Call `super.destroy()`. Set `this.onLocationRequest = undefined`.

Import `NewsItem` from `@/types`. Import `escapeHtml`, `sanitizeUrl` from `@/utils/sanitize`.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no type errors. Verify the file has the `onLocationRequest` callback property and handles undefined lat/lon gracefully.</verify>
  <done>HeroSpotlightPanel class exists, extends Panel, renders a hero card with photo/title/source/time, conditionally shows map button only when coordinates exist, and exposes onLocationRequest callback for App.ts wiring.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `src/components/BreakthroughsTickerPanel.ts` exists and exports `BreakthroughsTickerPanel`
3. `src/components/HeroSpotlightPanel.ts` exists and exports `HeroSpotlightPanel`
4. `src/config/feeds.ts` HAPPY_FEEDS.science has 5 entries
5. Both panels import from `@/utils/sanitize` for safe content rendering
6. HeroSpotlightPanel handles undefined lat/lon without calling onLocationRequest
</verification>

<success_criteria>
- Two new Panel subclasses compile and follow the established CountersPanel/ProgressChartsPanel pattern
- Science feeds expanded from 1 to 5 in HAPPY_FEEDS
- No type errors in the project
</success_criteria>

<output>
After completion, create `.planning/phases/06-content-spotlight-panels/06-01-SUMMARY.md`
</output>
