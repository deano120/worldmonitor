---
phase: 06-content-spotlight-panels
plan: 03
type: execute
wave: 2
depends_on:
  - "06-01"
  - "06-02"
files_modified:
  - src/App.ts
  - src/config/variants/happy.ts
  - src/styles/happy-theme.css
autonomous: true
requirements:
  - SCI-01
  - SCI-02
  - HERO-01
  - HERO-02
  - HERO-03
  - DIGEST-01
  - DIGEST-02

must_haves:
  truths:
    - "All three panels (breakthroughs, spotlight, digest) are instantiated in App.ts createPanels() under SITE_VARIANT === 'happy' guard"
    - "Breakthroughs ticker receives science-filtered items from happyAllItems after content pipeline runs"
    - "Hero panel receives the most recent inspiring-category item and its onLocationRequest callback drives map.setCenter + map.flashLocation"
    - "Digest panel receives top 5 items from happyAllItems sorted by date"
    - "All three panels are destroyed in App.destroy() before map cleanup"
    - "digest key added to DEFAULT_PANELS in happy.ts config"
    - "CSS for ticker animation, hero card, and digest list exists in happy-theme.css"
  artifacts:
    - path: "src/App.ts"
      provides: "Panel wiring for breakthroughs, spotlight, and digest"
      contains: "BreakthroughsTickerPanel"
    - path: "src/config/variants/happy.ts"
      provides: "digest panel key in DEFAULT_PANELS"
      contains: "digest"
    - path: "src/styles/happy-theme.css"
      provides: "CSS for ticker, hero card, and digest panels"
      contains: "happy-ticker-scroll"
  key_links:
    - from: "src/App.ts"
      to: "src/components/BreakthroughsTickerPanel.ts"
      via: "import and instantiation in createPanels()"
      pattern: "new BreakthroughsTickerPanel"
    - from: "src/App.ts"
      to: "src/components/HeroSpotlightPanel.ts"
      via: "import and instantiation in createPanels()"
      pattern: "new HeroSpotlightPanel"
    - from: "src/App.ts"
      to: "src/components/GoodThingsDigestPanel.ts"
      via: "import and instantiation in createPanels()"
      pattern: "new GoodThingsDigestPanel"
    - from: "src/App.ts"
      to: "src/components/MapContainer.ts"
      via: "heroPanel.onLocationRequest -> map.setCenter + map.flashLocation"
      pattern: "onLocationRequest"
---

<objective>
Wire all three Phase 6 panels into App.ts lifecycle, add the digest key to happy.ts config, and add CSS styles for ticker, hero card, and digest to happy-theme.css.

Purpose: This plan connects the panel classes (built in 06-01 and 06-02) to the application data flow, making them visible and functional on the dashboard. Without this wiring, the panels exist as orphan classes.

Output: Updated App.ts (imports, createPanels, data flow, destroy), updated happy.ts (digest key), updated happy-theme.css (all three panel styles).
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-content-spotlight-panels/06-RESEARCH.md
@.planning/phases/06-content-spotlight-panels/06-01-SUMMARY.md
@.planning/phases/06-content-spotlight-panels/06-02-SUMMARY.md
@src/App.ts
@src/config/variants/happy.ts
@src/styles/happy-theme.css
@src/components/BreakthroughsTickerPanel.ts
@src/components/HeroSpotlightPanel.ts
@src/components/GoodThingsDigestPanel.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire panels into App.ts and update happy.ts config</name>
  <files>src/App.ts, src/config/variants/happy.ts</files>
  <action>
**1. Add imports at top of App.ts** (near existing CountersPanel/ProgressChartsPanel imports around line 101-102):

```typescript
import { BreakthroughsTickerPanel } from '@/components/BreakthroughsTickerPanel';
import { HeroSpotlightPanel } from '@/components/HeroSpotlightPanel';
import { GoodThingsDigestPanel } from '@/components/GoodThingsDigestPanel';
```

**2. Add private properties** (near `countersPanel` and `progressPanel` declarations around line 210-211):

```typescript
private breakthroughsPanel?: BreakthroughsTickerPanel;
private heroPanel?: HeroSpotlightPanel;
private digestPanel?: GoodThingsDigestPanel;
```

**3. Instantiate in createPanels()** — Add after the progress panel block (after line ~2429), still inside the file, using the same pattern of separate `SITE_VARIANT === 'happy'` guards:

```typescript
// Breakthroughs Ticker Panel (happy variant only)
if (SITE_VARIANT === 'happy') {
  this.breakthroughsPanel = new BreakthroughsTickerPanel();
  this.panels['breakthroughs'] = this.breakthroughsPanel;
}

// Hero Spotlight Panel (happy variant only)
if (SITE_VARIANT === 'happy') {
  this.heroPanel = new HeroSpotlightPanel();
  this.panels['spotlight'] = this.heroPanel;
  // Wire map location callback
  this.heroPanel.onLocationRequest = (lat: number, lon: number) => {
    this.map?.setCenter(lat, lon, 4);
    this.map?.flashLocation(lat, lon, 3000);
  };
}

// Good Things Digest Panel (happy variant only)
if (SITE_VARIANT === 'happy') {
  this.digestPanel = new GoodThingsDigestPanel();
  this.panels['digest'] = this.digestPanel;
}
```

**4. Feed data to panels after content pipeline** — In `loadHappySupplementaryAndRender()`, AFTER the existing Stage 4 merge+render block (after the `this.positivePanel.renderPositiveNews(merged)` or after the entire method's try/catch), add data distribution to the new panels:

```typescript
// Feed data to Phase 6 panels
const scienceSources = ['GNN Science', 'ScienceDaily', 'Nature News', 'Live Science', 'New Scientist'];
const scienceItems = this.happyAllItems.filter(item =>
  scienceSources.includes(item.source) || item.happyCategory === 'science-health'
);
this.breakthroughsPanel?.setItems(scienceItems);

// Hero: pick most recent inspiring item
const heroItem = this.happyAllItems
  .filter(item => item.happyCategory === 'humanity-kindness')
  .sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime())[0];
this.heroPanel?.setHeroStory(heroItem);

// Digest: top 5 most recent items across all categories
const digestItems = [...this.happyAllItems]
  .sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime())
  .slice(0, 5);
this.digestPanel?.setStories(digestItems);
```

Place this AFTER the Stage 4 merged render block. This runs regardless of whether supplementary loaded (curated items are sufficient). Use the FINAL merged state of happyAllItems (after supplementary concat).

IMPORTANT: The data distribution must run even if supplementary fails (it's in a try/catch). Place it AFTER the try/catch block in `loadHappySupplementaryAndRender()`, before the method returns, so it always executes.

**5. Add destroy calls** — In `App.destroy()`, add before the existing `this.map?.destroy()` call (near line 2115-2116 where countersPanel and progressPanel are destroyed):

```typescript
this.breakthroughsPanel?.destroy();
this.heroPanel?.destroy();
this.digestPanel?.destroy();
```

**6. Update DEFAULT_PANELS in `src/config/variants/happy.ts`** — Add digest key after breakthroughs:

```typescript
digest: { name: '5 Good Things', enabled: true, priority: 1 },
```

This ensures the digest panel appears in the panel grid ordering.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no type errors. Grep App.ts for `BreakthroughsTickerPanel`, `HeroSpotlightPanel`, `GoodThingsDigestPanel` to confirm all three are imported, instantiated, fed data, and destroyed.</verify>
  <done>All three panels wired into App.ts lifecycle (create, data feed, destroy). Hero panel's onLocationRequest drives map.setCenter + map.flashLocation. Digest key added to happy.ts DEFAULT_PANELS. Panel data flows from happyAllItems after content pipeline completes.</done>
</task>

<task type="auto">
  <name>Task 2: Add CSS styles for ticker, hero card, and digest panels</name>
  <files>src/styles/happy-theme.css</files>
  <action>
Add CSS rules to the END of `src/styles/happy-theme.css` (before any closing comments), following the existing `[data-variant="happy"]` selector pattern. All selectors MUST be scoped under `[data-variant="happy"]`.

**1. Breakthroughs Ticker CSS:**

```css
/* === Breakthroughs Ticker === */
@keyframes happy-ticker-scroll {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

[data-variant="happy"] .breakthroughs-ticker-wrapper {
  overflow: hidden;
  position: relative;
  padding: 0.5rem 0;
}

[data-variant="happy"] .breakthroughs-ticker-track {
  display: flex;
  width: max-content;
  gap: 2rem;
  animation: happy-ticker-scroll 30s linear infinite;
}

[data-variant="happy"] .breakthroughs-ticker-wrapper:hover .breakthroughs-ticker-track {
  animation-play-state: paused;
}

[data-variant="happy"] .ticker-item {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
  padding: 0.4rem 0.75rem;
  border-radius: 6px;
  background: var(--bg-elevated, rgba(255,255,255,0.05));
  text-decoration: none;
  color: var(--text);
  font-size: 0.85rem;
  transition: background 0.2s;
}

[data-variant="happy"] .ticker-item:hover {
  background: var(--bg-hover, rgba(255,255,255,0.1));
}

[data-variant="happy"] .ticker-item-source {
  color: var(--yellow);
  font-weight: 600;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

[data-variant="happy"] .ticker-item-title {
  color: var(--text);
}
```

**2. Hero Spotlight Card CSS:**

```css
/* === Hero Spotlight Card === */
[data-variant="happy"] .hero-card {
  display: flex;
  flex-direction: column;
  gap: 0;
  border-radius: var(--panel-radius, 14px);
  overflow: hidden;
  background: var(--bg-elevated, rgba(255,255,255,0.05));
}

[data-variant="happy"] .hero-card-image {
  width: 100%;
  max-height: 200px;
  overflow: hidden;
}

[data-variant="happy"] .hero-card-image img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  display: block;
}

[data-variant="happy"] .hero-card-body {
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

[data-variant="happy"] .hero-card-source {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.03em;
  color: var(--yellow);
}

[data-variant="happy"] .hero-card-title {
  font-size: 1.1rem;
  font-weight: 700;
  line-height: 1.3;
  margin: 0;
}

[data-variant="happy"] .hero-card-title a {
  color: var(--text);
  text-decoration: none;
}

[data-variant="happy"] .hero-card-title a:hover {
  text-decoration: underline;
}

[data-variant="happy"] .hero-card-time {
  font-size: 0.8rem;
  color: var(--text-muted, var(--text));
  opacity: 0.7;
}

[data-variant="happy"] .hero-card-location-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.75rem;
  border: 1px solid var(--green);
  border-radius: 6px;
  background: transparent;
  color: var(--green);
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.2s, color 0.2s;
  align-self: flex-start;
}

[data-variant="happy"] .hero-card-location-btn:hover {
  background: var(--green);
  color: var(--bg);
}
```

**3. Good Things Digest CSS:**

```css
/* === Good Things Digest === */
[data-variant="happy"] .digest-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

[data-variant="happy"] .digest-card {
  display: flex;
  gap: 0.75rem;
  align-items: flex-start;
  padding: 0.75rem;
  border-radius: 8px;
  background: var(--bg-elevated, rgba(255,255,255,0.05));
  transition: background 0.2s;
}

[data-variant="happy"] .digest-card:hover {
  background: var(--bg-hover, rgba(255,255,255,0.1));
}

[data-variant="happy"] .digest-card-number {
  flex-shrink: 0;
  width: 1.8rem;
  height: 1.8rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  background: var(--green);
  color: #fff;
  font-weight: 700;
  font-size: 0.85rem;
}

[data-variant="happy"] .digest-card-body {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

[data-variant="happy"] .digest-card-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text);
  text-decoration: none;
  line-height: 1.3;
}

[data-variant="happy"] .digest-card-title:hover {
  text-decoration: underline;
}

[data-variant="happy"] .digest-card-source {
  font-size: 0.7rem;
  color: var(--text-muted, var(--text));
  opacity: 0.7;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

[data-variant="happy"] .digest-card-summary {
  font-size: 0.85rem;
  color: var(--text);
  opacity: 0.85;
  line-height: 1.4;
  margin: 0.25rem 0 0;
}

[data-variant="happy"] .digest-card-summary--loading {
  opacity: 0.5;
  font-style: italic;
}
```

**4. Dark mode overrides** (use compound selector pattern):

```css
/* === Phase 6 Dark Mode Overrides === */
[data-variant="happy"][data-theme="dark"] .ticker-item {
  background: rgba(255, 255, 255, 0.06);
}

[data-variant="happy"][data-theme="dark"] .ticker-item:hover {
  background: rgba(255, 255, 255, 0.12);
}

[data-variant="happy"][data-theme="dark"] .hero-card {
  background: rgba(255, 255, 255, 0.06);
}

[data-variant="happy"][data-theme="dark"] .digest-card {
  background: rgba(255, 255, 255, 0.06);
}

[data-variant="happy"][data-theme="dark"] .digest-card:hover {
  background: rgba(255, 255, 255, 0.12);
}
```

All rules use the project's existing CSS variable names (`--text`, `--bg`, `--green`, `--yellow`, `--text-muted`, `--bg-elevated`, `--bg-hover`, `--panel-radius`). Check existing happy-theme.css for the actual variable names before writing -- use what exists.
  </action>
  <verify>Run the dev server (`npm run dev:happy`) and confirm no CSS syntax errors in browser console. Verify the @keyframes animation name `happy-ticker-scroll` does not conflict with existing animation names in happy-theme.css.</verify>
  <done>CSS styles for all three Phase 6 panels added to happy-theme.css with proper [data-variant="happy"] scoping, dark mode overrides, ticker scroll animation, hero card layout, and numbered digest cards.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. App.ts imports all three panel classes
3. App.ts createPanels() instantiates all three under SITE_VARIANT === 'happy' guard
4. App.ts loadHappySupplementaryAndRender() distributes data to breakthroughsPanel, heroPanel, digestPanel
5. App.ts destroy() calls destroy on all three panels
6. happy.ts DEFAULT_PANELS includes `digest` key
7. happy-theme.css contains `@keyframes happy-ticker-scroll`, `.hero-card`, `.digest-list` rules
8. All CSS selectors scoped under `[data-variant="happy"]`
</verification>

<success_criteria>
- All three Phase 6 panels visible in the happy variant dashboard
- Ticker scrolls horizontally with science stories
- Hero card shows photo, title, and optional map location button
- Digest shows numbered cards with titles immediately, then summaries progressively
- Destroy lifecycle properly cleans up all three panels
- No type errors, no CSS conflicts
</success_criteria>

<output>
After completion, create `.planning/phases/06-content-spotlight-panels/06-03-SUMMARY.md`
</output>
